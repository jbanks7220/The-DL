<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The-DL Dashboard</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; background: #111; color: #eee; }
    header { padding: 1rem; background: #222; text-align: center; }
    main { display: flex; flex-wrap: wrap; gap: 1rem; padding: 1rem; }
    section { background: #222; padding: 1rem; border-radius: 8px; flex: 1 1 300px; min-height: 300px; }
    #camera-feed { width: 100%; height: 360px; background: #000; }
    #mesh-map { width: 100%; height: 360px; }
    #live-messages { max-height: 360px; overflow-y: auto; }
</style>
</head>
<body>

<header>
    <h1>The-DL Dashboard</h1>
</header>

<main>
    <!-- CCTV Feed -->
    <section>
        <h2>CCTV Feed</h2>
        <img id="camera-feed" src="/camera/" alt="CCTV Feed">
    </section>

    <!-- Mesh Map -->
    <section>
        <h2>Mesh Map</h2>
        <div id="mesh-map">Loading mesh map...</div>
    </section>

    <!-- Live Messages -->
    <section>
        <h2>Live Messages</h2>
        <div id="live-messages">Loading messages...</div>
    </section>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // ===== Mesh Map =====
    const meshMapEl = document.getElementById('mesh-map');
    const fetchMeshData = () => {
        fetch('/meshdata.json')
        .then(res => res.json())
        .then(data => {
            meshMapEl.innerHTML = '';
            const list = document.createElement('ul');
            data.nodes?.forEach(node => {
                const li = document.createElement('li');
                li.textContent = `${node.id}: ${node.status}`;
                list.appendChild(li);
            });
            meshMapEl.appendChild(list);
        })
        .catch(err => {
            meshMapEl.textContent = 'Failed to load mesh map.';
            console.error(err);
        });
    };
    fetchMeshData();
    setInterval(fetchMeshData, 5000); // refresh every 5s

    // ===== Live Messages =====
    const messagesEl = document.getElementById('live-messages');
    const dummyMessages = [
        "System initialized",
        "Node 12 online",
        "Node 23 offline",
        "Message received from Node 7"
    ];
    let msgIndex = 0;
    const updateMessages = () => {
        messagesEl.innerHTML = '';
        for (let i = 0; i < dummyMessages.length; i++) {
            const div = document.createElement('div');
            div.textContent = dummyMessages[(msgIndex + i) % dummyMessages.length];
            messagesEl.appendChild(div);
        }
        msgIndex = (msgIndex + 1) % dummyMessages.length;
    };
    updateMessages();
    setInterval(updateMessages, 3000);

    // ===== CCTV Feed =====
    const cameraFeed = document.getElementById('camera-feed');
    cameraFeed.src = '/camera/';
});
</script>

</body>
</html>
